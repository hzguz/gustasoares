rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // ðŸ”’ SECURANÃ‡A MÃXIMA: Substitua pelo seu UID real do Firebase Authentication
    // Isso garante que SÃ“ VOCÃŠ (e nenhum outro usuÃ¡rio logado) consiga alterar dados.
    function isOwner() {
       // VÃ¡ no Firebase Console > Authentication > Users e copie a coluna "User UID"
       return request.auth != null && request.auth.uid == 'COLE_SEU_UID_AQUI';
    }

    // ðŸ›¡ï¸ VALIDAÃ‡ÃƒO DE DADOS (Schema Validation)
    // Evita injeÃ§Ã£o de dados corrompidos ou maliciosos
    function isValidProject() {
      let incoming = request.resource.data;
      
      // ValidaÃ§Ãµes bÃ¡sicas de tipo e tamanho
      return incoming.title is string 
             && incoming.title.size() > 0 
             && incoming.title.size() < 100
             && incoming.descriptionShort is string
             && incoming.descriptionShort.size() < 500;
    }

    match /projects/{projectId} {
      // ðŸŒ LEITURA: PÃºblica
      allow read: if true;

      // ðŸ” ESCRITA: Blindada para o Admin
      allow create: if isOwner() && isValidProject();
      allow update: if isOwner() && isValidProject();
      allow delete: if isOwner();
    }
  }
}
